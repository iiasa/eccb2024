---
code-annotations: hover
---

# Preparing input data {#sec-dataprep}

## Planning units

Planning units (PU) contains the spatial data of the study area. Here, we use raster format, so the planning units are 10x10 km grid cells in Europe.

Let's read and plot the planning units raster.

```{r, eval = FALSE}

library(terra)
library(viridisLite)

PU <- rast("data/PlanningUnits.tif")
plot(PU, col = viridisLite::mako(n = 1))
```

![](/figures/data_PUmap.jpg)

The value of the planning units determines the cost of each planning unit in the prioritisation. In our case, we want to reach 30% area coverage. This means that in the Planning Units raster, each grid cell should have an equal value of 1 (so that the budget will be expressed in number of grid cells in prioritizr).

## Features

A feature is spatial data on the distribution of a biodiversity entity, typically a species, habitat, ecosystem service, etc.

Here, we consider the SDM of 67 tree species in Europe as features. We will focus on current distributions but we also have projected distributions under future climate (RCP 8.5) as part of this workshop.

Let's read the current SDM as a raster stack and plot one species as an example:

```{r, eval = FALSE}

spp.list <- list.files(path = "data/SpeciesDistributions/", full.names = T, recursive = T, pattern = "tif$")

spp <- rast(spp.list[grep("current", spp.list)])


names(spp) <- gsub("_ens-sdms_cur2005_prob_pot", "" ,names(spp))   # <1>

## plot first four species distributions  
plot(c(spp[[1]],spp[[2]], spp[[3]], spp[[4]]), axes = F,col = viridisLite::mako(n = 100, direction = -1), main = c(names(spp)[1:4]))



## also load the SDM projected under climate scenario rcp 8.5 
# read sdm under climate scenario rcp 8.5
spp.rcp85 <- rast(spp.list[grep("rcp85", spp.list)])

# rename feature layers by species names
names(spp.rcp85) <- gsub("_ens-sdms_rcp85_fut2065_prob_pot.tif", "" ,names(spp.rcp85))

```

1.  Rename feature layers by species names. This will enable to link the features rasters to a table of feature characteristics, weights, targets, taxonomy.

![](/figures/data_species.PNG){width="559"}

Note: features, and all other spatial data, need to be perfectly harmonized with the planning units data and (same extent, resolution, number of grid cells). This step must be done prior to the prioritisation, as part of the data preparation. For this training workshop, the data is already prepared, but bear in mind that data preparation is an essential step in the conservation planning process, which often takes time.

## Protected areas

Often, we do not start from scratch: we often want to identify top priorities that **complement and expand on existing** protected areas.

```{r}

# load protected areas data
PA <- rast("data/protectedareas.tif")

# load strict protected areas
stPA <-  rast("data/protectedareas_I_II.tif")


plot(c(PA, stPA), axes = F, col = viridisLite::mako(n = 100, direction = -1), main = c("Protected areas \n (all)", "Strictly protected areas \n (IUCN I and II)"))

```

![](/figures/data_PA_stPA.PNG){width="484"}

## Locked-out or no-go areas

Here we use layers of high-intensity forests and urban areas as a proxy, using 1kmÂ² European land systems data from @dou2021new . We lock out the planning units that have over 50% of urban and peri-urban, or over 50% of high intensity forest. In doing so, we assume that, in these high-intensity areas, conservation would likely conflict with economic interests.

```{r, eval = F}

## create locked out constraints to define areas that should be left out of the solution.

## from Dou et al., 2021
## aggregated at 10x10 k and aligned with the planning units raster
HI.forest <- rast("data/HI_forest_prct.tif")

urban <- rast("data/urban_prct.tif")

plot(c(HI.forest, urban), axes = F, col = viridisLite::mako(n = 10, direction = -1), main = c("High intensity forest", "Urban and peri-urban areas") )


locked.out <- sum(HI.forest, urban)
rclmat <- matrix(ncol = 3, nrow = 2, byrow = T,
                 c(0,50, 0,
                   50, 101, 1))

locked.out.bin <- terra::classify(locked.out, rclmat) ## convert to binary : 1 = pu that have more than 50% coverage of urban and/or HI forest.

```

![](/figures/data_hi_forest_urban.PNG){width="517"}

## Costs

Costs are typically spatially-explicit socio-economic data that can be factored into a prioritization to account for the feasibility of implementing conservation in a planning unit. There are different types of costs:

-   Acquisition cost = price of land/water area

-   Opportunity cost = lost revenue to other land use types

-   Transaction cost = e.g. cost of negotiating protection

-   Management cost = maintenance and management of the PA

In reality, we rarely have this information and need to use proxies. Here, we use global human modification (GHM) as a proxy for socio-economic costs. Including the GHM as a cost layer would assume that highly human-dominated landscapes would be more costly to protect, than others.

```{r}

gHM <- rast("data/gHM.tif")

gHM[gHM<0.3] <- 0 ## set threshold so that sites that have GHM index lower than specified threshold are not penalized

plot(gHM, axes = F, col = viridisLite::mako(n = 10, direction = -1), main = "global human modification index")

```

![](/figures/data_ghm.PNG){width="297"}

## Vegetation quality

NDVI is often interpreted as dense and healthy vegetation, and one may be interested in selecting sites with a higher NDVI.

```{r, eval  = F}
ndvi <- rast("data/ndvi.tif")
```

![](/figures/data_ndvi.PNG){width="348"}

## Other data for the prioritization

Spatial prioritisations can also be shaped by the importance of certain feature relative to others (e.g. threat status). This can be addressed by the use of feature-specific weights.

For setting weights, we will use the red list dataset and assign higher weight to more vulnerable species, following @jung2021areas :

-   default weight of 1 for Least Concern species.

-   2 for near-threatened and data-deficient species

-   4 for vulnerable species

-   6 for endangered species

-   8 for critically endangered species.

```{r, eval = FALSE}
 
## read red list information
redlist.trees <- read.csv('data/species_red_list.csv')

## assign weight based on red list status
redlist.trees$weight <- ifelse(redlist.trees$Global == "Vulnerable" | redlist.trees$Europe == "Vulnerable", 4,
                                      ifelse(redlist.trees$Global == "Near Threatened" | redlist.trees$Europe == "Near Threatened", 2,
                                             ifelse(redlist.trees$Global == "Data Deficient" | redlist.trees$Europe == "Data Deficient", 2, 1)))

## must be in the same order as the features (spp) rasterstack
rownames(redlist.trees) <- redlist.trees$spp_name
redlist.trees <- redlist.trees[names(spp),]

```

Another important aspect of planning are area-based targets, which define the amount of the distribution of each feature that is deemed sufficient to protect. One typical approach for targets is to use log-linear targets @neugarten2024mapping . Another is to use the IUCN criteria to set targets based on the minimizing extinction risk @jung2021areas .
